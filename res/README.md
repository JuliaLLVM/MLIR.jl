**NOTE**: after wrapping TODOs.

1. Remember to change `OperationState` to mutable. 
2. Wrap structs with `@checked`, as required.
3. Change `ptr` fields to `ref` so that `@checked` doesn't complain.
